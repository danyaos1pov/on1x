<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ON1X VPN MiniApp</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
<style>
/* === ВСЕ СТИЛИ ОСТАЮТСЯ БЕЗ ИЗМЕНЕНИЙ === */
:root {
    --primary-color: #007bff;
    --bg-dark: #0d1117;
    --card-bg: #161b22;
    --text-color: #e6edf3;
}
* { box-sizing:border-box; margin:0; padding:0; font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,sans-serif; }
body { background:var(--bg-dark); color:var(--text-color); text-align:center; min-height:100vh; padding-bottom:50px; }

/* МОДАЛЬНОЕ ОКНО */
#modal-overlay{
    position:fixed;top:0;left:0;width:100%;height:100%;
    background:rgba(0,0,0,0.7);backdrop-filter:blur(5px);
    display:none;justify-content:center;align-items:center;z-index:10002;
    opacity:0;transition:opacity .3s ease;
}
#modal-overlay.visible{display:flex;opacity:1;}
#modal-popup{
    background:var(--card-bg);padding:25px;border-radius:20px;
    border:1px solid rgba(255,255,255,.1);box-shadow:0 10px 30px rgba(0,0,0,.5);
    width:90%;max-width:380px;text-align:center;
    transform:scale(.9);transition:transform .3s cubic-bezier(.3,.7,.4,1.2);
}
#modal-overlay.visible #modal-popup{transform:scale(1);}
#modal-popup i{font-size:48px;color:var(--primary-color);margin-bottom:15px;}
#modal-title{font-size:1.5em;font-weight:700;margin-bottom:10px;color:var(--text-color);}
#modal-message{font-size:1em;color:#b0b8c2;line-height:1.6;margin-bottom:25px;}
#modal-close-button{
    background:var(--primary-color);color:#fff;border:none;border-radius:10px;
    padding:12px 0;width:100%;font-size:1em;font-weight:600;cursor:pointer;
    transition:background .2s;
}
#modal-close-button:hover{background:#0056b3;}

/* СЕТКА МЕНЮ */
.menu-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;max-width:500px;margin:10px auto 20px auto;}
.menu-card{
    background:var(--card-bg);padding:15px 10px;border-radius:15px;
    display:flex;flex-direction:column;justify-content:center;align-items:center;
    cursor:pointer;font-weight:600;color:var(--text-color);
    box-shadow:0 4px 10px rgba(0,0,0,.3);border:1px solid rgba(255,255,255,.05);
    min-height:80px;font-size:.85em;
}
.menu-card:hover{box-shadow:0 4px 12px rgba(0,0,0,.6);border-color:var(--primary-color);}
.menu-card i{font-size:24px;margin-bottom:5px;color:var(--primary-color);}
</style>
</head>
<body>

<div id="app-container">

    <!-- HOME -->
    <div id="home" class="page">
        <h1>ON1X VPN</h1>

        <div class="menu-grid">
            <div class="menu-card" onclick="showPage('install')"><i class="fas fa-download"></i>Установка</div>
            <div class="menu-card" onclick="showPage('status')"><i class="fas fa-shield-alt"></i>Статус</div>
            <div class="menu-card" onclick="showPage('faq')"><i class="fas fa-lightbulb"></i>FAQ</div>
            <div class="menu-card" onclick="showPage('support')"><i class="fas fa-headset"></i>Поддержка</div>
            <div class="menu-card" onclick="window.location.href='https://t.me/on1xVPN_bot?start=f_5371698'"><i class="fas fa-user-plus"></i>Друзья</div>

            <!-- КНОПКА ТЕСТИРОВАНИЕ -->
            <div class="menu-card" onclick="openTestingLink()">
                <i class="fas fa-vial"></i>Тестирование
            </div>
        </div>
    </div>

    <!-- ВСТАВЬТЕ ОСТАЛЬНЫЕ СТРАНИЦЫ -->

</div>

<!-- МОДАЛЬНОЕ ОКНО -->
<div id="modal-overlay">
    <div id="modal-popup">
        <i class="fas fa-paper-plane"></i>
        <h3 id="modal-title">Перейти в Telegram</h3>
        <p id="modal-message">Для того, чтобы открыть сообщение, необходимо перейти в Telegram</p>
        <button id="modal-close-button">Перейти в Telegram</button>
    </div>
</div>

<script>
// === ИНИЦИАЛИЗАЦИЯ TELEGRAM WEBAPP ===
let webApp = null;
try {
    webApp = window.Telegram?.WebApp;
    if (webApp) {
        webApp.ready();
        webApp.expand();
    }
} catch (e) {
    console.log('Telegram WebApp недоступен');
}

// === МОДАЛЬНОЕ ОКНО ===
const modalOverlay = document.getElementById('modal-overlay');
const modalBtn = document.getElementById('modal-close-button');

function showModal(title, message, btnText, onClick) {
    document.getElementById('modal-title').textContent = title;
    document.getElementById('modal-message').textContent = message;
    modalBtn.textContent = btnText;
    modalBtn.onclick = () => {
        hideModal();
        if (onClick) onClick();
    };
    modalOverlay.classList.add('visible');
}

function hideModal() {
    modalOverlay.classList.remove('visible');
}

modalOverlay.addEventListener('click', e => {
    if (e.target === modalOverlay) hideModal();
});

// === ГЛАВНАЯ ФУНКЦИЯ: ТЕСТИРОВАНИЕ ===
function openTestingLink() {
    const botLink = 'https://t.me/on1xVPN_bot?start=f_5372173';
    const tgDeepLink = `tg://resolve?domain=on1xVPN_bot&start=f_5372173`;

    // 1. Показываем модалку
    showModal(
        'Перейти в Telegram',
        'Для того, чтобы открыть сообщение, необходимо перейти в Telegram',
        'Перейти в Telegram',
        () => {
            // 2. ЗАКРЫВАЕМ MiniApp
            if (webApp && typeof webApp.close === 'function') {
                webApp.close();
            }

            // 3. ОТКРЫВАЕМ ССЫЛКУ ЧЕРЕЗ 100мс (после закрытия)
            setTimeout(() => {
                // Пробуем через tg:// (откроется в Telegram)
                const a = document.createElement('a');
                a.href = tgDeepLink;
                a.style.display = 'none';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);

                // Резерв: если tg:// не сработал — через https
                setTimeout(() => {
                    window.location.href = botLink;
                }, 500);
            }, 100);
        }
    );

    // 4. Автоматически закрываем MiniApp через 300мс (на всякий случай)
    setTimeout(() => {
        if (webApp && typeof webApp.close === 'function') {
            webApp.close();
        }
    }, 300);
}

// === Дополнительно: если пользователь нажмёт "Тестирование" — сразу открыть ===
document.querySelectorAll('[onclick="openTestingLink()"]').forEach(el => {
    el.addEventListener('click', () => {
        // Ничего не делаем — всё в функции
    });
});
</script>
</body>
</html>
